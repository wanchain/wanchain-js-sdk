const p = require('path');
var { config } = require('./conf/config');
const WalletCore  = require("../index").walletCore;
const hdUtil = require("../index").hdUtil;
const offlineDeployer = require("../index").offlineDeployer;

async function main(){
  /* init wallet */
  config.walletPathPrex = p.join('C:/Users/zhangwei/AppData/Roaming/Wan Wallet/test/Db', 'walletDB');
  config.databasePathPrex = p.join('C:/Users/zhangwei/AppData/Roaming/Wan Wallet/Db', `${config.network}DB`, 'sdk');

	walletCore = new WalletCore(config);
	await walletCore.init();

  let phrase = hdUtil.revealMnemonic("wallet-password");
  hdUtil.initializeHDWallet(phrase);
  hdUtil.newKeyStoreWallet("wallet-password");

  /* select account */
  let walletId = 5;
  let path = "m/44'/5718350'/0'/0/0";

  /******** WAN ********/

  let txs = [
    {
      toAddress: '0xBC874a59aCb43B21315f399E648eFF114f4E2f41',
      abi: [{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"groupMap","outputs":[{"name":"groupId","type":"bytes32"},{"name":"round","type":"uint16"},{"name":"ployCommitPeriod","type":"uint32"},{"name":"defaultPeriod","type":"uint32"},{"name":"negotiatePeriod","type":"uint32"},{"name":"smNumber","type":"uint16"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"cfg","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"admin","type":"address"}],"name":"removeAdmin","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"smg","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"admin","type":"address"}],"name":"addAdmin","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"renounceOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"changeOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"mapAdmin","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"},{"indexed":true,"name":"curveIndex","type":"uint8"},{"indexed":false,"name":"storeman","type":"address"}],"name":"SetPolyCommitLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"},{"indexed":true,"name":"curveIndex","type":"uint8"},{"indexed":false,"name":"src","type":"address"},{"indexed":false,"name":"dest","type":"address"}],"name":"SetEncSijLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"},{"indexed":true,"name":"curveIndex","type":"uint8"},{"indexed":false,"name":"src","type":"address"},{"indexed":false,"name":"dest","type":"address"},{"indexed":false,"name":"isValid","type":"bool"}],"name":"SetCheckStatusLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"},{"indexed":true,"name":"curveIndex","type":"uint8"},{"indexed":false,"name":"src","type":"address"},{"indexed":false,"name":"dest","type":"address"}],"name":"RevealSijLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"admin","type":"address"}],"name":"AddAdmin","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"admin","type":"address"}],"name":"RemoveAdmin","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"previousOwner","type":"address"},{"indexed":true,"name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"constant":false,"inputs":[{"name":"cfgAddr","type":"address"},{"name":"smgAddr","type":"address"}],"name":"setDependence","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"ployCommitPeriod","type":"uint32"},{"name":"defaultPeriod","type":"uint32"},{"name":"negotiatePeriod","type":"uint32"}],"name":"setPeriod","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"polyCommit","type":"bytes"}],"name":"setPolyCommit","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"curveIndex","type":"uint8"}],"name":"polyCommitTimeout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"dest","type":"address"},{"name":"encSij","type":"bytes"}],"name":"setEncSij","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"src","type":"address"},{"name":"isValid","type":"bool"}],"name":"setCheckStatus","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"curveIndex","type":"uint8"},{"name":"src","type":"address"}],"name":"encSijTimeout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"dest","type":"address"},{"name":"sij","type":"uint256"},{"name":"ephemPrivateKey","type":"uint256"}],"name":"revealSij","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"curveIndex","type":"uint8"},{"name":"dest","type":"address"}],"name":"checkSijTimeout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"curveIndex","type":"uint8"},{"name":"src","type":"address"}],"name":"SijTimeout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"curveIndex","type":"uint8"}],"name":"terminate","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"int32"}],"name":"getGroupInfo","outputs":[{"name":"queriedRound","type":"uint16"},{"name":"curve1","type":"address"},{"name":"curve1Status","type":"uint8"},{"name":"curve1StatusTime","type":"uint256"},{"name":"curve2","type":"address"},{"name":"curve2Status","type":"uint8"},{"name":"curve2StatusTime","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"src","type":"address"}],"name":"getPolyCommit","outputs":[{"name":"polyCommit","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"src","type":"address"},{"name":"dest","type":"address"}],"name":"getSijInfo","outputs":[{"name":"encSij","type":"bytes"},{"name":"checkStatus","type":"uint8"},{"name":"setTime","type":"uint256"},{"name":"checkTime","type":"uint256"},{"name":"sij","type":"uint256"},{"name":"ephemPrivateKey","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"index","type":"uint16"}],"name":"getGpkShare","outputs":[{"name":"gpkShare1","type":"bytes"},{"name":"gpkShare2","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"groupId","type":"bytes32"}],"name":"getGpk","outputs":[{"name":"gpk1","type":"bytes"},{"name":"gpk2","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"},{"indexed":false,"name":"gpk1","type":"bytes"},{"indexed":false,"name":"gpk2","type":"bytes"}],"name":"GpkCreatedLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"slashType","type":"uint8"},{"indexed":true,"name":"slashed","type":"address"},{"indexed":false,"name":"partner","type":"address"},{"indexed":false,"name":"round","type":"uint16"},{"indexed":false,"name":"curveIndex","type":"uint8"}],"name":"SlashLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"}],"name":"ResetLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"}],"name":"CloseLogger","type":"event"}],
      method: 'addAdmin',
      paras: ['0xb9dd855dc6a9340ea6b566a5b454202115bcf485']
    },
    {
      toAddress: '0xBC874a59aCb43B21315f399E648eFF114f4E2F41',
      abi: [{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"groupMap","outputs":[{"name":"groupId","type":"bytes32"},{"name":"round","type":"uint16"},{"name":"ployCommitPeriod","type":"uint32"},{"name":"defaultPeriod","type":"uint32"},{"name":"negotiatePeriod","type":"uint32"},{"name":"smNumber","type":"uint16"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"cfg","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"admin","type":"address"}],"name":"removeAdmin","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"smg","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"admin","type":"address"}],"name":"addAdmin","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"renounceOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"changeOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"mapAdmin","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"},{"indexed":true,"name":"curveIndex","type":"uint8"},{"indexed":false,"name":"storeman","type":"address"}],"name":"SetPolyCommitLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"},{"indexed":true,"name":"curveIndex","type":"uint8"},{"indexed":false,"name":"src","type":"address"},{"indexed":false,"name":"dest","type":"address"}],"name":"SetEncSijLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"},{"indexed":true,"name":"curveIndex","type":"uint8"},{"indexed":false,"name":"src","type":"address"},{"indexed":false,"name":"dest","type":"address"},{"indexed":false,"name":"isValid","type":"bool"}],"name":"SetCheckStatusLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"},{"indexed":true,"name":"curveIndex","type":"uint8"},{"indexed":false,"name":"src","type":"address"},{"indexed":false,"name":"dest","type":"address"}],"name":"RevealSijLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"admin","type":"address"}],"name":"AddAdmin","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"admin","type":"address"}],"name":"RemoveAdmin","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"previousOwner","type":"address"},{"indexed":true,"name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"constant":false,"inputs":[{"name":"cfgAddr","type":"address"},{"name":"smgAddr","type":"address"}],"name":"setDependence","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"ployCommitPeriod","type":"uint32"},{"name":"defaultPeriod","type":"uint32"},{"name":"negotiatePeriod","type":"uint32"}],"name":"setPeriod","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"polyCommit","type":"bytes"}],"name":"setPolyCommit","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"curveIndex","type":"uint8"}],"name":"polyCommitTimeout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"dest","type":"address"},{"name":"encSij","type":"bytes"}],"name":"setEncSij","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"src","type":"address"},{"name":"isValid","type":"bool"}],"name":"setCheckStatus","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"curveIndex","type":"uint8"},{"name":"src","type":"address"}],"name":"encSijTimeout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"dest","type":"address"},{"name":"sij","type":"uint256"},{"name":"ephemPrivateKey","type":"uint256"}],"name":"revealSij","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"curveIndex","type":"uint8"},{"name":"dest","type":"address"}],"name":"checkSijTimeout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"curveIndex","type":"uint8"},{"name":"src","type":"address"}],"name":"SijTimeout","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"curveIndex","type":"uint8"}],"name":"terminate","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"int32"}],"name":"getGroupInfo","outputs":[{"name":"queriedRound","type":"uint16"},{"name":"curve1","type":"address"},{"name":"curve1Status","type":"uint8"},{"name":"curve1StatusTime","type":"uint256"},{"name":"curve2","type":"address"},{"name":"curve2Status","type":"uint8"},{"name":"curve2StatusTime","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"src","type":"address"}],"name":"getPolyCommit","outputs":[{"name":"polyCommit","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"roundIndex","type":"uint16"},{"name":"curveIndex","type":"uint8"},{"name":"src","type":"address"},{"name":"dest","type":"address"}],"name":"getSijInfo","outputs":[{"name":"encSij","type":"bytes"},{"name":"checkStatus","type":"uint8"},{"name":"setTime","type":"uint256"},{"name":"checkTime","type":"uint256"},{"name":"sij","type":"uint256"},{"name":"ephemPrivateKey","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"groupId","type":"bytes32"},{"name":"index","type":"uint16"}],"name":"getGpkShare","outputs":[{"name":"gpkShare1","type":"bytes"},{"name":"gpkShare2","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"groupId","type":"bytes32"}],"name":"getGpk","outputs":[{"name":"gpk1","type":"bytes"},{"name":"gpk2","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"},{"indexed":false,"name":"gpk1","type":"bytes"},{"indexed":false,"name":"gpk2","type":"bytes"}],"name":"GpkCreatedLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"slashType","type":"uint8"},{"indexed":true,"name":"slashed","type":"address"},{"indexed":false,"name":"partner","type":"address"},{"indexed":false,"name":"round","type":"uint16"},{"indexed":false,"name":"curveIndex","type":"uint8"}],"name":"SlashLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"}],"name":"ResetLogger","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"groupId","type":"bytes32"},{"indexed":true,"name":"round","type":"uint16"}],"name":"CloseLogger","type":"event"}],
      method: 'setPeriod',
      paras: ['0x000000000000000000000000000000000000000000746573746e65745f303038', 86400, 86400, 86400]
    },
    {
      toAddress: '0x165d1526ECbb8F3DAD789C640C5b0d6a3D499496',
      value: 100
    }    
  ];

  await offlineDeployer.initNonce(walletId, path);
  await offlineDeployer.buildTx(walletId, path, txs);
  await offlineDeployer.setFilePath('sendTx', p.join(config.databasePathPrex, 'offlineDeployer/txData/0xb9dd855dc6a9340ea6b566a5b454202115bcf485.dat'));
  await offlineDeployer.sendTx();

  console.log("offlineDeployer finished");
}

main();